name: Summary

on:
  workflow_call:
    inputs:
      build-result:
        required: false
        type: string
        default: 'unknown'
      unit-tests-result:
        required: false
        type: string
        default: 'unknown'

jobs:
  summary:
    runs-on: ubuntu-latest
    steps:
      - name: Generate Summary Report
        run: |
          echo "## CI/CD Pipeline Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Stage | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|--------|" >> $GITHUB_STEP_SUMMARY

          if [ "${{ inputs.build-result }}" == "success" ]; then
            echo "| Build | âœ… Passed |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ inputs.build-result }}" == "failure" ]; then
            echo "| Build | âŒ Failed |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ inputs.build-result }}" == "cancelled" ]; then
            echo "| Build | â¹ï¸ Cancelled |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ inputs.build-result }}" == "skipped" ]; then
            echo "| Build | â­ï¸ Skipped |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| Build | â“ Unknown |" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ inputs.build-result }}" == "success" ]; then
            echo "### ðŸŽ‰ All checks passed!" >> $GITHUB_STEP_SUMMARY
          else
            echo "### âš ï¸ Some checks failed" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY

          echo "**Pipeline Details:**" >> $GITHUB_STEP_SUMMARY
          echo "- **Trigger:** ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch:** ${{ github.head_ref || github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Author:** ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ github.head_ref }}" == "main" ]; then
            echo "**Note:** Security scan will run automatically on this PR to main." >> $GITHUB_STEP_SUMMARY
          fi

          if [ "${{ inputs.build-result }}" == "failure" ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### Failed Jobs:" >> $GITHUB_STEP_SUMMARY
            [ "${{ inputs.build-result }}" == "failure" ] && echo "- âŒ Build" >> $GITHUB_STEP_SUMMARY
          fi